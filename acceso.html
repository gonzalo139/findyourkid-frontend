<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso Padres - Codexia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-900 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-md w-full bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="p-8 text-center bg-slate-800 text-white">
            <h1 class="text-3xl font-black italic">CODEXIA</h1>
            <p id="auth-title" class="text-slate-400 mt-2">Acceso para Padres</p>
        </div>

        <div class="p-8">
            <form id="auth-form" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase">Email</label>
                    <input type="email" id="email" required class="w-full border rounded-xl p-3 outline-none focus:ring-2 focus:ring-slate-800">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase">Contraseña</label>
                    <input type="password" id="password" required class="w-full border rounded-xl p-3 outline-none focus:ring-2 focus:ring-slate-800">
                </div>

                <button type="submit" id="btn-auth" class="w-full bg-slate-800 text-white font-bold py-4 rounded-2xl hover:bg-black transition-all">
                    INGRESAR
                </button>
            </form>

            <div class="mt-6 text-center">
                <button type="button" onclick="toggleAuth()" id="toggle-link" class="text-sm text-slate-500 hover:underline">
                    ¿No tienes cuenta? Regístrate aquí
                </button>
            </div>
            
            <div id="msg" class="mt-4 text-center text-sm font-bold p-3 rounded-lg hidden"></div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = "https://rjaacuwxoigrrbkonaxh.supabase.co";
        const SUPABASE_KEY = "sb_publishable_ZM-DArvmuNJxD3-04H6DsA_V08HNAqL"; // Usa la 'anon public' de la imagen que pasaste
        
        // Inicialización global
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let isLogin = true;

        function toggleAuth() {
            isLogin = !isLogin;
            document.getElementById('auth-title').innerText = isLogin ? "Acceso para Padres" : "Crear nueva cuenta";
            document.getElementById('btn-auth').innerText = isLogin ? "INGRESAR" : "REGISTRARME";
            document.getElementById('toggle-link').innerText = isLogin ? "¿No tienes cuenta? Regístrate aquí" : "¿Ya tienes cuenta? Ingresa aquí";
        }

        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault(); // Evita que la página se recargue
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const msg = document.getElementById('msg');
            const btn = document.getElementById('btn-auth');

            btn.disabled = true;
            msg.innerText = "Procesando...";
            msg.className = "mt-4 text-center text-sm font-bold p-3 rounded-lg bg-slate-100 text-slate-700";
            msg.classList.remove('hidden');

            try {
                let result;
                if (isLogin) {
                    result = await _supabase.auth.signInWithPassword({ email, password });
                } else {
                    result = await _supabase.auth.signUp({ email, password });
                }

                if (result.error) {
                    throw result.error;
                }

                // Éxito
                if (isLogin) {
                    msg.innerText = "¡Ingreso exitoso! Redirigiendo...";
                    msg.className = "mt-4 text-center text-sm font-bold p-3 rounded-lg bg-green-100 text-green-700";
                    setTimeout(() => { window.location.href = "admin.html"; }, 1500);
                } else {
                    msg.innerText = "Cuenta creada. Revisa tu email para confirmar.";
                    msg.className = "mt-4 text-center text-sm font-bold p-3 rounded-lg bg-blue-100 text-blue-700";
                }

            } catch (error) {
                msg.innerText = "Error: " + error.message;
                msg.className = "mt-4 text-center text-sm font-bold p-3 rounded-lg bg-red-100 text-red-700";
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
